import os

import numpy as np
import pytest
import torch
from numpy.testing import assert_array_almost_equal
from PIL import Image
from ultralytics.engine.results import Results

from datachain.model.yolo import (
    YoloBox,
    YoloCls,
    YoloObb,
    YoloPose,
    YoloSeg,
)


@pytest.fixture
def running_img() -> np.ndarray:
    img_file = os.path.join(os.path.dirname(__file__), "data", "running.jpg")
    return np.array(Image.open(img_file))


@pytest.fixture
def ships_img() -> np.ndarray:
    img_file = os.path.join(os.path.dirname(__file__), "data", "ships.jpg")
    return np.array(Image.open(img_file))


@pytest.fixture
def running_img_masks() -> torch.Tensor:
    mask0_file = os.path.join(os.path.dirname(__file__), "data", "running-mask0.png")
    mask0_np = np.array(Image.open(mask0_file))

    mask1_file = os.path.join(os.path.dirname(__file__), "data", "running-mask1.png")
    mask1_np = np.array(Image.open(mask1_file))

    return torch.tensor([mask0_np.astype(np.float32), mask1_np.astype(np.float32)])


def test_yolo_box_from_results_empty(running_img):
    result = Results(
        orig_img=running_img,
        path="running.jpeg",
        names={},
        boxes=torch.empty((0, 6)),
    )

    model = YoloBox.from_yolo_results([result])
    assert model.model_dump() == {
        "cls": [],
        "name": [],
        "confidence": [],
        "box": [],
        "orig_shape": [],
    }


def test_yolo_box_from_results(running_img):
    result = Results(
        orig_img=running_img,
        path="running.jpeg",
        names={0: "person", 16: "dog"},
        boxes=torch.tensor(
            [
                [100.2483, 83.7399, 183.179, 238.1918, 0.9057, 0.0],
                [10.8968, 177.1552, 71.1275, 239.0617, 0.8919, 16.0],
            ],
        ),
    )

    model = YoloBox.from_yolo_results([result])
    assert model.img_size == (200, 300)

    model_json = model.model_dump()
    assert set(model_json.keys()) == {"cls", "name", "confidence", "box", "orig_shape"}
    assert model_json["cls"] == [0, 16]
    assert model_json["name"] == ["person", "dog"]
    assert_array_almost_equal(model_json["confidence"], [0.9057, 0.8919], decimal=3)
    assert len(model_json["box"]) == 2
    assert_array_almost_equal(
        model_json["box"][0],
        [100.2483, 83.7399, 183.179, 238.1918],
        decimal=3,
    )
    assert_array_almost_equal(
        model_json["box"][1],
        [10.8968, 177.1552, 71.1275, 239.0617],
        decimal=3,
    )
    assert model_json["orig_shape"] == [300, 200]

    alb_boxes = list(model.to_albumentations())
    assert len(alb_boxes) == 2
    assert_array_almost_equal(
        alb_boxes[0],
        [0.5012, 0.2791, 0.9159, 0.794],
        decimal=3,
    )
    assert_array_almost_equal(
        alb_boxes[1],
        [0.05448, 0.5905, 0.3556, 0.7969],
        decimal=3,
    )

    coco_boxes = list(model.to_coco())
    assert len(coco_boxes) == 2
    assert coco_boxes[0] == [100, 84, 83, 154]
    assert coco_boxes[1] == [11, 177, 60, 62]

    voc_boxes = list(model.to_voc())
    assert len(voc_boxes) == 2
    assert voc_boxes[0] == [100, 84, 183, 238]
    assert voc_boxes[1] == [11, 177, 71, 239]

    yolo_boxes = list(model.to_yolo())
    assert len(yolo_boxes) == 2
    assert_array_almost_equal(
        yolo_boxes[0],
        [0.7086, 0.5366, 0.4147, 0.5148],
        decimal=3,
    )
    assert_array_almost_equal(
        yolo_boxes[1],
        [0.2051, 0.6937, 0.3012, 0.2064],
        decimal=3,
    )


def test_yolo_obb_from_results_empty(ships_img):
    result = Results(
        orig_img=ships_img,
        path="ships.jpeg",
        names={},
        obb=torch.empty((0, 7)),
    )

    model = YoloObb.from_yolo_results([result])
    assert model.model_dump() == {
        "cls": [],
        "name": [],
        "confidence": [],
        "obox": [],
        "orig_shape": [],
    }


def test_yolo_obb_from_results(ships_img):
    result = Results(
        orig_img=ships_img,
        path="ships.jpeg",
        names={1: "ship"},
        obb=torch.tensor(
            [
                [272.7724, 83.4637, 80.2673, 41.5667, 0.5629, 0.7289, 1.0],
                [70.2, 95.1912, 143.2061, 48.404, 0.494, 0.5785, 1.0],
                [120.6607, 76.8303, 115.6623, 42.3174, 0.7043, 0.5677, 1.0],
            ]
        ),
    )

    model = YoloObb.from_yolo_results([result])
    assert model.img_size == (300, 200)

    model_dict = model.model_dump()
    assert set(model_dict.keys()) == {"cls", "name", "confidence", "obox", "orig_shape"}
    assert model_dict["cls"] == [1, 1, 1]
    assert model_dict["name"] == ["ship", "ship", "ship"]
    assert_array_almost_equal(
        model_dict["confidence"], [0.7289, 0.5785, 0.5677], decimal=3
    )
    assert len(model_dict["obox"]) == 3
    assert_array_almost_equal(
        model_dict["obox"][0],
        [
            295.62302,
            122.45737,
            317.80472,
            87.30396,
            249.92178,
            44.47003,
            227.74008,
            79.62344,
        ],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["obox"][1],
        [
            121.76702,
            150.45038,
            144.71785,
            107.8334,
            18.63298,
            39.93202,
            -4.31784,
            82.549,
        ],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["obox"][2],
        [
            151.03152,
            130.4003,
            178.43207,
            98.1517,
            90.28987,
            23.2603,
            62.88933,
            55.50891,
        ],
        decimal=3,
    )
    assert model_dict["orig_shape"] == [200, 300]


def test_yolo_seg_from_results_empty(running_img):
    result = Results(
        orig_img=running_img,
        path="running.jpeg",
        names={},
        obb=torch.empty((0, 7)),
    )

    model = YoloSeg.from_yolo_results([result])
    assert model.model_dump() == {
        "cls": [],
        "name": [],
        "confidence": [],
        "box": [],
        "segments": [],
        "orig_shape": [],
    }


def test_yolo_seg_from_results(running_img, running_img_masks):
    result = Results(
        orig_img=running_img,
        path="running.jpeg",
        names={0: "person", 16: "dog"},
        boxes=torch.tensor(
            [
                [11.6684, 178.2727, 71.4605, 238.8026, 0.9157, 16.0],
                [100.8046, 84.3006, 183.2971, 238.1916, 0.8578, 0.0],
            ],
        ),
        masks=running_img_masks,
    )

    model = YoloSeg.from_yolo_results([result])

    model_dict = model.model_dump()
    assert set(model_dict.keys()) == {
        "cls",
        "name",
        "confidence",
        "box",
        "segments",
        "orig_shape",
    }
    assert model_dict["cls"] == [16, 0]
    assert model_dict["name"] == ["dog", "person"]
    assert_array_almost_equal(model_dict["confidence"], [0.9157, 0.8578], decimal=3)
    assert len(model_dict["box"]) == 2
    assert_array_almost_equal(
        model_dict["box"][0],
        [11.6684, 178.2727, 71.4605, 238.8026],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["box"][1],
        [100.8046, 84.3006, 183.2971, 238.1916],
        decimal=3,
    )
    assert len(model_dict["segments"]) == 2
    assert len(model_dict["segments"][0]) == 2
    assert_array_almost_equal(
        model_dict["segments"][0][0],
        [
            16.0938,
            16.0938,
            15.625,
            15.625,
            15.1562,
            15.1562,
            14.6875,
            14.6875,
            14.2188,
            14.2188,
            13.75,
            13.75,
            13.2812,
            13.2812,
            12.3438,
            10.9375,
            10.9375,
            12.8125,
            13.75,
            14.2188,
            15.625,
            16.0938,
            17.0312,
            17.0312,
            20.3125,
            20.3125,
            20.7812,
            20.7812,
            21.25,
            21.25,
            21.7188,
            21.7188,
            22.1875,
            22.1875,
            22.6562,
            22.6562,
            22.1875,
            22.1875,
            21.7188,
            21.7188,
            21.25,
            21.25,
            20.7812,
            20.7812,
            20.3125,
            20.3125,
            19.8438,
            19.8438,
            19.375,
            19.375,
            18.9062,
            18.9062,
            18.4375,
            18.4375,
            16.5625,
            16.5625,
            15.625,
            15.625,
            16.0938,
            17.0312,
            17.5,
            22.6562,
            23.5938,
            25.4688,
            25.9375,
            25.9375,
            26.4062,
            26.4062,
            26.875,
            27.3438,
            28.75,
            29.2188,
            30.1562,
            30.625,
            31.0938,
            32.5,
            32.5,
            35.7812,
            35.7812,
            37.6562,
            37.6562,
            38.5938,
            38.5938,
            40.0,
            40.0,
            40.4688,
            40.4688,
            40.9375,
            40.9375,
            41.4062,
            41.4062,
            42.8125,
            42.8125,
            44.6875,
            45.1562,
            45.625,
            46.5625,
            47.0312,
            49.8438,
            50.3125,
            51.25,
            51.7188,
            52.1875,
            52.6562,
            53.5938,
            56.4062,
            56.4062,
            58.75,
            58.75,
            60.1562,
            60.1562,
            60.625,
            60.625,
            61.0937,
            61.0937,
            61.5625,
            61.5625,
            62.0312,
            62.0312,
            62.5,
            62.5,
            62.9687,
            63.4375,
            65.3125,
            65.7812,
            66.25,
            66.7187,
            67.1875,
            67.6562,
            67.6562,
            68.125,
            68.125,
            68.5937,
            68.5937,
            68.125,
            68.125,
            68.5937,
            68.5937,
            69.0625,
            69.0625,
            69.5312,
            69.5312,
            70.0,
            70.0,
            70.4687,
            70.4687,
            70.9375,
            72.3437,
            72.3437,
            70.9375,
            70.4687,
            70.4687,
            70.0,
            70.0,
            69.5312,
            69.5312,
            69.0625,
            69.0625,
            68.5937,
            68.5937,
            68.125,
            68.125,
            67.1875,
            67.1875,
            66.7187,
            66.7187,
            65.7812,
            65.7812,
            65.3125,
            65.3125,
            64.8437,
            64.8437,
            64.375,
            64.375,
            63.4375,
            63.4375,
            62.5,
            62.0312,
            61.5625,
            61.0937,
            60.625,
            60.1562,
            59.2188,
            58.75,
            58.2812,
            57.8125,
            57.3438,
            56.875,
            56.4062,
            55.9375,
            55.4688,
            55.0,
            54.5312,
            54.0625,
            51.7188,
            51.7188,
            50.7812,
            50.7812,
            49.375,
            48.9062,
            48.4375,
            44.2188,
            43.75,
            41.875,
            41.4062,
            38.5938,
            38.125,
            36.7188,
            36.25,
            35.7812,
            35.3125,
            34.8438,
            34.375,
            33.9062,
            33.4375,
            32.9688,
            32.5,
            32.0312,
            30.625,
            30.625,
            30.1562,
            30.1562,
            24.5312,
            24.5312,
            23.5938,
            22.6562,
            21.25,
            20.7812,
            20.3125,
            19.375,
            18.9062,
            18.4375,
            17.9688,
            17.9688,
        ],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["segments"][0][1],
        [
            179.0625,
            180.4687,
            180.9375,
            181.4062,
            181.875,
            182.3437,
            182.8125,
            184.6875,
            185.1562,
            185.625,
            186.0937,
            186.5625,
            187.0312,
            187.5,
            188.4375,
            188.4375,
            200.1562,
            200.1562,
            201.0937,
            201.0937,
            202.5,
            202.5,
            203.4375,
            203.9062,
            207.1875,
            207.6562,
            208.125,
            209.0625,
            209.5312,
            210.9375,
            211.4062,
            211.875,
            212.3437,
            213.2812,
            213.75,
            219.375,
            219.8437,
            221.7187,
            222.1875,
            223.125,
            223.5937,
            225.4687,
            225.9375,
            226.875,
            227.3437,
            227.8125,
            228.2812,
            228.75,
            229.2187,
            229.6875,
            230.1562,
            230.625,
            231.0937,
            231.5625,
            233.4375,
            233.9062,
            234.8437,
            235.3125,
            235.7812,
            235.7812,
            236.25,
            236.25,
            235.3125,
            235.3125,
            235.7812,
            236.25,
            236.7187,
            237.1875,
            237.1875,
            237.6562,
            237.6562,
            237.1875,
            237.1875,
            236.7187,
            236.7187,
            235.3125,
            234.8437,
            231.5625,
            231.0937,
            229.2187,
            228.75,
            227.8125,
            227.3437,
            225.9375,
            225.4687,
            225.0,
            224.5312,
            224.0625,
            223.5937,
            223.125,
            222.6562,
            221.25,
            220.7812,
            218.9062,
            218.9062,
            218.4375,
            218.4375,
            217.9687,
            217.9687,
            218.4375,
            218.4375,
            218.9062,
            218.9062,
            219.375,
            219.375,
            222.1875,
            222.6562,
            225.0,
            225.4687,
            226.875,
            227.3437,
            227.8125,
            228.2812,
            228.75,
            229.6875,
            230.1562,
            234.8437,
            235.3125,
            235.7812,
            236.25,
            236.7187,
            236.7187,
            237.1875,
            237.1875,
            236.7187,
            236.7187,
            236.25,
            236.25,
            235.7812,
            235.3125,
            234.8437,
            232.9687,
            232.5,
            228.75,
            228.2812,
            225.9375,
            225.4687,
            221.25,
            220.7812,
            219.375,
            218.9062,
            217.9687,
            217.5,
            216.0937,
            215.625,
            215.1562,
            214.6875,
            214.6875,
            202.5,
            202.5,
            202.0312,
            201.0937,
            200.625,
            199.6875,
            199.2187,
            198.2812,
            197.8125,
            197.3437,
            196.875,
            196.4062,
            195.9375,
            195.4687,
            194.5312,
            194.0625,
            193.5937,
            193.125,
            192.1875,
            191.7187,
            191.25,
            190.3125,
            189.8437,
            189.375,
            188.9062,
            188.4375,
            187.5,
            187.0312,
            186.0937,
            186.0937,
            185.625,
            185.625,
            185.1562,
            185.1562,
            184.2187,
            184.2187,
            183.75,
            183.75,
            183.2812,
            183.2812,
            182.8125,
            182.8125,
            182.3437,
            182.3437,
            182.8125,
            182.8125,
            185.1562,
            185.625,
            186.5625,
            187.0312,
            188.4375,
            188.4375,
            188.9062,
            188.9062,
            188.4375,
            188.4375,
            187.9687,
            187.9687,
            187.5,
            187.5,
            187.0312,
            187.0312,
            186.5625,
            186.5625,
            186.0937,
            186.0937,
            185.625,
            185.625,
            185.1562,
            185.1562,
            183.75,
            183.2812,
            182.8125,
            179.0625,
            179.0625,
            180.4687,
            181.4062,
            181.4062,
            182.8125,
            182.8125,
            183.2812,
            183.2812,
            182.8125,
            182.8125,
            182.3437,
            179.0625,
        ],
        decimal=3,
    )
    assert len(model_dict["segments"][1]) == 2
    assert_array_almost_equal(
        model_dict["segments"][1][0],
        [
            135.625,
            135.625,
            132.3438,
            132.3438,
            132.8125,
            132.8125,
            133.75,
            133.75,
            134.2188,
            134.2188,
            134.6875,
            134.6875,
            135.1562,
            135.1562,
            135.625,
            135.625,
            135.1562,
            135.1562,
            132.3438,
            131.875,
            129.5312,
            129.5312,
            128.5938,
            128.5938,
            128.125,
            128.125,
            127.6562,
            127.6562,
            127.1875,
            127.1875,
            126.7188,
            126.7188,
            126.25,
            126.25,
            125.7812,
            125.7812,
            125.3125,
            125.3125,
            124.8438,
            124.8438,
            124.375,
            124.375,
            123.9062,
            123.9062,
            123.4375,
            123.4375,
            122.9688,
            122.9688,
            122.5,
            122.5,
            122.0312,
            122.0312,
            121.5625,
            121.5625,
            121.0938,
            121.0938,
            120.625,
            120.625,
            120.1562,
            120.1562,
            119.2187,
            119.2187,
            118.2812,
            118.2812,
            117.3437,
            117.3437,
            116.875,
            116.875,
            116.4062,
            116.4062,
            115.4687,
            115.4687,
            115.0,
            115.0,
            114.5312,
            114.5312,
            114.0625,
            114.0625,
            113.5937,
            113.5937,
            113.125,
            113.125,
            110.7812,
            110.3125,
            109.8437,
            108.9062,
            108.4375,
            107.9687,
            107.5,
            107.0312,
            106.5625,
            106.0937,
            105.625,
            105.1562,
            104.6875,
            104.2187,
            102.8125,
            100.9375,
            100.9375,
            103.2812,
            103.75,
            104.2187,
            105.1562,
            105.625,
            106.5625,
            107.5,
            107.9687,
            108.9062,
            109.375,
            111.25,
            111.7187,
            112.1875,
            112.6562,
            113.125,
            114.0625,
            114.5312,
            115.0,
            115.4687,
            115.9375,
            116.4062,
            117.3437,
            119.2187,
            119.6875,
            120.1562,
            119.6875,
            119.6875,
            120.625,
            120.625,
            121.5625,
            122.0312,
            123.4375,
            124.375,
            124.8438,
            125.3125,
            125.3125,
            126.25,
            126.25,
            127.6562,
            128.125,
            128.125,
            129.0625,
            130.4688,
            130.4688,
            130.0,
            130.0,
            129.5312,
            129.5312,
            129.0625,
            129.0625,
            128.5938,
            128.5938,
            129.0625,
            129.0625,
            130.0,
            130.0,
            130.4688,
            130.4688,
            132.8125,
            132.8125,
            133.2812,
            133.2812,
            133.75,
            133.75,
            134.2188,
            134.2188,
            134.6875,
            134.6875,
            135.1562,
            135.1562,
            135.625,
            135.625,
            136.0938,
            136.0938,
            136.5625,
            136.5625,
            137.0312,
            137.0312,
            137.5,
            137.5,
            137.9688,
            137.9688,
            138.4375,
            138.4375,
            138.9062,
            138.9062,
            139.375,
            139.375,
            139.8438,
            139.8438,
            140.3125,
            140.3125,
            139.8438,
            139.8438,
            139.375,
            139.375,
            138.9062,
            138.9062,
            138.4375,
            138.4375,
            137.9688,
            137.9688,
            137.5,
            137.5,
            137.0312,
            137.0312,
            136.5625,
            136.5625,
            136.0938,
            136.0938,
            135.1562,
            135.1562,
            133.75,
            132.8125,
            132.3438,
            129.0625,
            128.5938,
            128.125,
            126.7188,
            126.7188,
            126.25,
            126.25,
            126.7188,
            126.7188,
            127.6562,
            127.6562,
            129.0625,
            130.4688,
            130.9375,
            131.875,
            132.3438,
            133.2812,
            133.75,
            137.5,
            137.9688,
            144.0625,
            144.0625,
            144.5312,
            144.5312,
            145.0,
            145.0,
            144.5312,
            144.5312,
            143.5938,
            143.5938,
            143.125,
            143.125,
            143.5938,
            143.5938,
            144.0625,
            144.0625,
            144.5312,
            144.5312,
            145.0,
            145.0,
            145.4688,
            145.4688,
            145.9375,
            145.9375,
            146.4062,
            146.4062,
            146.875,
            146.875,
            147.3438,
            147.3438,
            147.8125,
            147.8125,
            148.2812,
            148.2812,
            148.75,
            148.75,
            149.2188,
            149.2188,
            149.6875,
            149.6875,
            150.1562,
            150.1562,
            150.625,
            150.625,
            151.0938,
            151.0938,
            151.5625,
            151.5625,
            152.9688,
            158.5938,
            159.0625,
            159.5312,
            161.4062,
            161.4062,
            161.875,
            161.875,
            161.4062,
            161.4062,
            160.9375,
            160.9375,
            161.4062,
            161.4062,
            162.8125,
            165.1562,
            165.625,
            166.0938,
            168.4375,
            168.4375,
            168.9062,
            168.9062,
            169.375,
            169.375,
            169.8438,
            169.8438,
            170.3125,
            170.3125,
            170.7812,
            170.7812,
            171.25,
            171.25,
            171.7188,
            171.7188,
            172.1875,
            172.1875,
            172.6562,
            172.6562,
            173.125,
            173.125,
            174.0625,
            174.0625,
            174.5312,
            174.5312,
            173.5938,
            172.6562,
            172.1875,
            163.75,
            163.2812,
            162.3438,
            161.4062,
            160.9375,
            160.4688,
            160.0,
            159.5312,
            159.0625,
            157.6562,
            157.1875,
            156.7188,
            156.25,
            155.7812,
            155.7812,
            154.375,
            154.8438,
            154.8438,
            155.3125,
            155.3125,
            156.25,
            156.25,
            156.7188,
            156.7188,
            157.1875,
            157.1875,
            157.6562,
            157.6562,
            158.125,
            158.125,
            158.5938,
            158.5938,
            159.5312,
            159.5312,
            160.0,
            160.0,
            161.4062,
            165.625,
            166.0938,
            167.5,
            167.9688,
            168.9062,
            169.375,
            169.8438,
            170.7812,
            171.25,
            171.7188,
            171.7188,
            172.1875,
            172.1875,
            173.125,
            173.125,
            173.5938,
            173.5938,
            174.0625,
            174.0625,
            174.5312,
            174.5312,
            175.0,
            175.0,
            176.4062,
            176.4062,
            177.8125,
            177.8125,
            180.1562,
            180.1562,
            181.0938,
            181.0938,
            181.5625,
            181.5625,
            182.5,
            182.5,
            182.9688,
            182.9688,
            183.4375,
            184.8438,
            184.8438,
            183.4375,
            182.9688,
            182.9688,
            182.5,
            182.5,
            182.0312,
            182.0312,
            181.5625,
            181.5625,
            181.0938,
            181.0938,
            180.625,
            180.625,
            180.1562,
            180.1562,
            179.6875,
            179.6875,
            179.2188,
            179.2188,
            178.75,
            178.75,
            178.2812,
            178.2812,
            177.3438,
            177.3438,
            176.875,
            176.875,
            176.4062,
            176.4062,
            175.0,
            175.0,
            174.5312,
            174.5312,
            173.125,
            173.125,
            171.25,
            171.25,
            170.3125,
            170.3125,
            168.9062,
            168.9062,
            167.5,
            167.0312,
            166.0938,
            165.625,
            165.1562,
            164.6875,
            164.2188,
            163.75,
            162.3438,
            161.875,
            161.4062,
            160.9375,
            160.4688,
            160.0,
            159.5312,
            159.0625,
            158.5938,
            158.125,
            157.6562,
            157.1875,
            155.7812,
            155.3125,
            154.8438,
            154.375,
            153.4375,
            153.4375,
            152.9688,
            152.9688,
            153.4375,
            153.4375,
            153.9062,
            153.9062,
            154.375,
            154.375,
            155.3125,
            155.7812,
            156.7188,
            156.25,
            156.25,
            155.3125,
            154.8438,
            154.375,
            153.4375,
            152.9688,
            152.5,
            152.0312,
            151.5625,
            149.6875,
            149.6875,
        ],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["segments"][1][1],
        [
            83.4375,
            84.8437,
            88.125,
            89.5312,
            90.0,
            90.4687,
            91.4062,
            91.875,
            92.3437,
            92.8125,
            93.2812,
            95.1562,
            95.625,
            100.3125,
            100.7812,
            105.0,
            105.4687,
            105.9375,
            108.75,
            108.75,
            111.0937,
            111.5625,
            112.5,
            112.9687,
            113.4375,
            113.9062,
            114.375,
            114.8437,
            115.3125,
            116.7187,
            117.1875,
            118.5937,
            119.0625,
            120.0,
            120.4687,
            121.875,
            122.3437,
            123.75,
            124.2187,
            125.625,
            126.0937,
            127.0312,
            127.5,
            127.9687,
            128.4375,
            128.9062,
            129.375,
            129.8438,
            130.3125,
            130.7812,
            131.25,
            132.1875,
            132.6562,
            133.125,
            133.5938,
            134.0625,
            134.5312,
            135.0,
            135.4688,
            135.9375,
            136.875,
            137.3438,
            138.2812,
            138.75,
            139.6875,
            140.1562,
            140.625,
            141.0938,
            141.5625,
            142.0312,
            142.9688,
            143.4375,
            143.9062,
            144.375,
            144.8438,
            145.3125,
            145.7812,
            146.25,
            146.7187,
            148.125,
            148.5937,
            149.0625,
            151.4062,
            151.4062,
            151.875,
            151.875,
            152.3437,
            152.3437,
            152.8125,
            152.8125,
            153.2812,
            153.2812,
            153.75,
            153.75,
            154.2187,
            154.2187,
            155.625,
            155.625,
            159.8437,
            159.8437,
            159.375,
            159.375,
            158.4375,
            158.4375,
            157.5,
            157.5,
            157.0312,
            157.0312,
            156.5625,
            156.5625,
            156.0937,
            156.0937,
            155.625,
            155.625,
            154.6875,
            154.6875,
            154.2187,
            154.2187,
            153.75,
            153.75,
            152.8125,
            152.8125,
            152.3437,
            152.3437,
            151.875,
            150.4687,
            149.5312,
            149.0625,
            148.125,
            148.125,
            146.7187,
            146.7187,
            146.25,
            146.25,
            145.7812,
            144.8438,
            144.375,
            142.9688,
            142.9688,
            142.5,
            141.5625,
            142.9688,
            143.4375,
            143.9062,
            147.1875,
            147.6562,
            148.5937,
            149.0625,
            150.9375,
            151.4062,
            155.625,
            156.0937,
            157.9687,
            158.9062,
            159.375,
            159.8437,
            160.3125,
            162.6562,
            163.125,
            163.5937,
            165.9375,
            166.4062,
            172.5,
            172.9687,
            175.7812,
            176.25,
            180.4687,
            180.9375,
            183.2812,
            183.75,
            185.625,
            186.0937,
            187.9687,
            188.4375,
            189.8437,
            190.3125,
            192.6562,
            193.125,
            195.0,
            195.4687,
            196.875,
            197.3437,
            197.8125,
            198.2812,
            198.75,
            199.2187,
            200.1562,
            200.625,
            201.0937,
            201.5625,
            202.9687,
            203.4375,
            204.8437,
            205.3125,
            207.1875,
            207.6562,
            211.875,
            212.3437,
            214.6875,
            215.1562,
            217.0312,
            217.5,
            219.375,
            219.8437,
            221.25,
            221.7187,
            222.1875,
            222.6562,
            223.125,
            224.0625,
            224.5312,
            225.9375,
            225.9375,
            226.4062,
            226.4062,
            226.875,
            226.875,
            228.2812,
            228.75,
            229.2187,
            231.5625,
            232.0312,
            232.9687,
            233.9062,
            234.375,
            235.7812,
            235.7812,
            236.25,
            236.25,
            236.7187,
            236.7187,
            237.1875,
            237.1875,
            237.6562,
            237.6562,
            237.1875,
            236.7187,
            235.7812,
            235.3125,
            234.8437,
            234.375,
            233.9062,
            232.9687,
            232.5,
            232.0312,
            228.2812,
            227.8125,
            226.875,
            226.4062,
            225.4687,
            225.0,
            224.5312,
            224.0625,
            223.125,
            222.6562,
            221.7187,
            221.25,
            220.7812,
            220.3125,
            218.9062,
            218.4375,
            217.5,
            217.0312,
            216.5625,
            216.0937,
            215.625,
            215.1562,
            214.6875,
            214.2187,
            213.2812,
            212.8125,
            211.4062,
            210.9375,
            209.5312,
            209.0625,
            207.6562,
            207.1875,
            206.25,
            205.7812,
            203.4375,
            202.9687,
            202.0312,
            200.625,
            200.625,
            201.0937,
            201.0937,
            202.9687,
            204.375,
            204.8437,
            206.7187,
            207.1875,
            208.5937,
            209.0625,
            213.75,
            214.2187,
            214.6875,
            216.0937,
            216.0937,
            215.625,
            215.625,
            213.2812,
            212.8125,
            212.3437,
            211.875,
            211.4062,
            210.4687,
            210.0,
            209.5312,
            209.0625,
            208.125,
            207.6562,
            206.7187,
            206.25,
            204.8437,
            204.375,
            203.9062,
            203.4375,
            202.9687,
            202.5,
            202.0312,
            201.5625,
            200.625,
            199.6875,
            199.2187,
            198.75,
            195.9375,
            195.0,
            195.0,
            194.5312,
            194.5312,
            194.0625,
            194.0625,
            193.125,
            193.125,
            192.6562,
            192.6562,
            192.1875,
            192.1875,
            190.7812,
            190.7812,
            190.3125,
            190.3125,
            189.8437,
            189.375,
            187.9687,
            187.5,
            186.5625,
            186.0937,
            185.625,
            184.6875,
            184.2187,
            183.75,
            183.2812,
            182.8125,
            181.875,
            181.4062,
            180.0,
            179.5312,
            178.125,
            177.6562,
            176.7187,
            175.7812,
            175.3125,
            174.8437,
            173.9062,
            172.5,
            172.5,
            172.0312,
            172.0312,
            171.5625,
            171.5625,
            171.0937,
            171.0937,
            170.1562,
            170.1562,
            169.6875,
            169.2187,
            168.75,
            168.2812,
            167.3437,
            164.0625,
            163.5937,
            163.125,
            162.6562,
            162.1875,
            161.7187,
            161.25,
            160.7812,
            160.3125,
            158.9062,
            158.4375,
            157.0312,
            156.5625,
            154.2187,
            153.75,
            152.8125,
            152.3437,
            151.875,
            151.4062,
            150.4687,
            149.0625,
            148.5937,
            148.125,
            147.6562,
            147.6562,
            142.5,
            142.5,
            142.0312,
            140.1562,
            139.6875,
            135.9375,
            135.4688,
            133.125,
            132.6562,
            132.1875,
            131.7188,
            131.25,
            130.7812,
            129.8438,
            129.375,
            128.9062,
            128.4375,
            127.9687,
            127.5,
            127.0312,
            126.5625,
            126.0937,
            125.625,
            125.1562,
            124.2187,
            123.75,
            123.2812,
            122.8125,
            122.3437,
            121.875,
            120.4687,
            120.0,
            119.5312,
            119.0625,
            117.6562,
            117.1875,
            115.3125,
            114.8437,
            113.9062,
            113.4375,
            112.0312,
            111.5625,
            110.1562,
            110.1562,
            109.2187,
            109.2187,
            108.75,
            108.75,
            108.2812,
            108.2812,
            106.875,
            106.875,
            106.4062,
            106.4062,
            105.9375,
            105.9375,
            105.4687,
            105.4687,
            105.0,
            105.0,
            104.5312,
            104.5312,
            103.125,
            103.125,
            102.6562,
            102.6562,
            101.7187,
            101.25,
            100.7812,
            97.5,
            97.0312,
            95.625,
            95.1562,
            93.75,
            93.2812,
            92.3437,
            91.4062,
            91.4062,
            90.4687,
            90.0,
            89.0625,
            88.125,
            88.125,
            87.6562,
            87.6562,
            87.1875,
            87.1875,
            86.7187,
            86.7187,
            84.8437,
            83.4375,
        ],
        decimal=3,
    )
    assert model_dict["orig_shape"] == [300, 200]


def test_yolo_pose_from_results_empty(running_img):
    result = Results(
        orig_img=running_img,
        path="running.jpeg",
        names={},
        obb=torch.empty((0, 7)),
    )

    model = YoloPose.from_yolo_results([result])
    assert model.model_dump() == {
        "cls": [],
        "name": [],
        "confidence": [],
        "box": [],
        "keypoints": [],
        "orig_shape": [],
    }


def test_yolo_pose_from_results(running_img, running_img_masks):
    result = Results(
        orig_img=running_img,
        path="running.jpeg",
        names={0: "person"},
        boxes=torch.tensor([[102.0, 84.0, 183.0, 238.0, 0.9078, 0.0]]),
        keypoints=torch.tensor(
            [
                [
                    [138.4593, 103.4513, 0.991],
                    [141.6461, 100.4834, 0.9863],
                    [136.6068, 100.2756, 0.8826],
                    [150.1754, 99.0366, 0.9691],
                    [0.0, 0.0, 0.2733],
                    [163.061, 114.3064, 0.9993],
                    [134.8462, 113.5232, 0.9977],
                    [179.6755, 136.7466, 0.9974],
                    [127.26, 130.8018, 0.9806],
                    [172.8256, 158.7771, 0.9962],
                    [118.0251, 146.8072, 0.9786],
                    [154.7233, 160.504, 0.9999],
                    [139.7511, 158.7988, 0.9997],
                    [143.9287, 193.5594, 0.9995],
                    [145.329, 190.7517, 0.9991],
                    [137.9563, 223.4, 0.9941],
                    [156.7822, 218.5813, 0.9921],
                ]
            ],
        ),
    )

    model = YoloPose.from_yolo_results([result])

    model_dict = model.model_dump()
    assert set(model_dict.keys()) == {
        "cls",
        "name",
        "confidence",
        "box",
        "keypoints",
        "orig_shape",
    }
    assert model_dict["cls"] == [0]
    assert model_dict["name"] == ["person"]
    assert_array_almost_equal(model_dict["confidence"], [0.9078], decimal=3)
    assert len(model_dict["box"]) == 1
    assert_array_almost_equal(
        model_dict["box"][0],
        [102.0, 84.0, 183.0, 238.0],
        decimal=3,
    )
    assert len(model_dict["keypoints"]) == 1
    assert len(model_dict["keypoints"][0]) == 3
    assert_array_almost_equal(
        model_dict["keypoints"][0][0],
        [
            138.4593,
            141.6461,
            136.6068,
            150.1754,
            0.0,
            163.061,
            134.8462,
            179.6755,
            127.26,
            172.8256,
            118.0251,
            154.7233,
            139.7511,
            143.9287,
            145.329,
            137.9563,
            156.7822,
        ],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["keypoints"][0][1],
        [
            103.4513,
            100.4834,
            100.2756,
            99.0366,
            0.0,
            114.3064,
            113.5232,
            136.7466,
            130.8018,
            158.7771,
            146.8072,
            160.504,
            158.7988,
            193.5594,
            190.7517,
            223.4,
            218.5813,
        ],
        decimal=3,
    )
    assert_array_almost_equal(
        model_dict["keypoints"][0][2],
        [
            0.991,
            0.9863,
            0.8826,
            0.9691,
            0.2733,
            0.9994,
            0.9977,
            0.9974,
            0.9806,
            0.9962,
            0.9786,
            0.9999,
            0.9997,
            0.9995,
            0.9991,
            0.9941,
            0.9921,
        ],
        decimal=3,
    )
    assert model_dict["orig_shape"] == [300, 200]


def test_yolo_cls_from_results_empty(ships_img):
    result = Results(
        orig_img=ships_img,
        path="ships.jpeg",
        names={},
        boxes=torch.empty((0, 6)),
    )

    model = YoloCls.from_yolo_results([result])
    assert model.model_dump() == {
        "cls": [],
        "name": [],
        "confidence": [],
    }


def test_yolo_cls_from_results(ships_img):
    result = Results(
        orig_img=ships_img,
        path="ships.jpeg",
        names={
            510: "container_ship",
            525: "dam",
            536: "dock",
            769: "rule",
            913: "wreck",
        },
        boxes=torch.empty((0, 6)),
        probs=torch.tensor(
            [
                1.0339e-06,
                5.4460e-06,
                3.1851e-05,
                6.8369e-06,
                3.4396e-06,
                2.0468e-06,
                5.0569e-06,
                2.8160e-07,
                2.7602e-08,
                8.5561e-08,
                3.1910e-07,
                6.6235e-08,
                2.1857e-06,
                5.6748e-07,
                1.8549e-05,
                4.8287e-07,
                6.9187e-07,
                3.0479e-06,
                2.2228e-06,
                3.2149e-07,
                1.1456e-07,
                3.2199e-08,
                8.1776e-08,
                1.7628e-07,
                2.9032e-08,
                8.0677e-08,
                5.6300e-07,
                3.8564e-06,
                7.2937e-07,
                1.4296e-07,
                4.9668e-06,
                2.5541e-07,
                5.8202e-07,
                1.6449e-06,
                9.8739e-06,
                5.4744e-06,
                9.2096e-05,
                6.3834e-06,
                4.9127e-07,
                7.6110e-07,
                5.0316e-07,
                1.6698e-06,
                6.4484e-07,
                2.5988e-07,
                2.9079e-06,
                2.1705e-07,
                1.1246e-06,
                2.1299e-06,
                2.2538e-07,
                5.1255e-06,
                3.2948e-06,
                8.7681e-07,
                1.0686e-07,
                3.4746e-06,
                4.4607e-07,
                5.9090e-07,
                1.7809e-06,
                8.5746e-06,
                4.8708e-06,
                1.4765e-06,
                1.0113e-05,
                3.5899e-05,
                4.4050e-06,
                2.1363e-07,
                1.0856e-05,
                3.0532e-05,
                2.0509e-07,
                6.0136e-07,
                3.5719e-07,
                2.5005e-06,
                1.1699e-07,
                9.6390e-07,
                3.4403e-07,
                4.6927e-07,
                9.4284e-08,
                3.6083e-06,
                1.6057e-05,
                2.7057e-06,
                2.7237e-07,
                7.2639e-06,
                7.6985e-08,
                1.4997e-09,
                2.4123e-08,
                1.6324e-08,
                6.5121e-08,
                6.0461e-07,
                6.4036e-08,
                6.9928e-06,
                5.0647e-06,
                2.6301e-07,
                8.6094e-07,
                4.0644e-07,
                5.9800e-07,
                5.4992e-07,
                1.7880e-07,
                6.4875e-08,
                5.9700e-06,
                1.7628e-07,
                8.0264e-08,
                3.0626e-08,
                5.9519e-07,
                1.4838e-05,
                1.1413e-07,
                3.9644e-06,
                4.2076e-08,
                4.9546e-07,
                4.6340e-07,
                3.2028e-07,
                1.3236e-07,
                4.9423e-07,
                1.1064e-06,
                1.3928e-06,
                3.9063e-06,
                4.6774e-07,
                5.3713e-07,
                9.9779e-08,
                2.7190e-07,
                6.4139e-07,
                1.3905e-06,
                1.7951e-06,
                1.4705e-06,
                5.8198e-06,
                2.2695e-05,
                2.7975e-05,
                7.0015e-06,
                1.7165e-05,
                3.7862e-06,
                1.8833e-06,
                6.6447e-07,
                3.4100e-06,
                5.6826e-07,
                5.3877e-07,
                3.8513e-06,
                3.7360e-07,
                1.4986e-07,
                2.8862e-08,
                1.6428e-05,
                1.3764e-07,
                2.5706e-09,
                2.6865e-07,
                1.6032e-07,
                7.0011e-07,
                6.5186e-08,
                1.3056e-07,
                5.5475e-05,
                2.6903e-08,
                9.1767e-08,
                1.8278e-05,
                2.2962e-07,
                2.4995e-06,
                2.7326e-05,
                3.5784e-07,
                1.1992e-08,
                5.2074e-08,
                3.2423e-07,
                7.5187e-07,
                2.4336e-07,
                8.3929e-08,
                6.7795e-08,
                2.4001e-08,
                2.4156e-08,
                2.1193e-06,
                2.3218e-07,
                3.7463e-07,
                8.4663e-08,
                8.2042e-07,
                4.4080e-07,
                2.9450e-08,
                1.3903e-07,
                2.8527e-07,
                1.4230e-06,
                7.9110e-07,
                4.0477e-07,
                2.2409e-07,
                6.7904e-07,
                2.7826e-08,
                7.9331e-08,
                1.4374e-07,
                3.1142e-07,
                1.4808e-07,
                1.1557e-07,
                3.2558e-07,
                2.3926e-06,
                2.4865e-07,
                6.0354e-07,
                6.7747e-06,
                2.9550e-07,
                2.5099e-07,
                4.4294e-07,
                4.5995e-06,
                3.3352e-07,
                5.4043e-07,
                3.4370e-07,
                1.0096e-07,
                4.0075e-08,
                1.2364e-06,
                2.4370e-07,
                1.6651e-07,
                1.1090e-06,
                1.8287e-07,
                9.3031e-08,
                2.4487e-07,
                1.9278e-07,
                2.2166e-07,
                7.6480e-07,
                4.1652e-08,
                1.0430e-07,
                3.2065e-07,
                1.3711e-06,
                3.6432e-07,
                1.6270e-07,
                2.3222e-07,
                8.7038e-08,
                4.4004e-08,
                1.9766e-08,
                1.6741e-06,
                3.4994e-07,
                7.9892e-08,
                1.7680e-08,
                4.9258e-08,
                4.1861e-07,
                3.3004e-08,
                7.7754e-07,
                9.3901e-06,
                2.5835e-07,
                4.7466e-07,
                8.4931e-08,
                7.1556e-08,
                1.5106e-07,
                1.7860e-07,
                1.8889e-06,
                5.7624e-07,
                2.5433e-07,
                1.3312e-07,
                4.4349e-07,
                2.9750e-07,
                9.8715e-08,
                1.4181e-07,
                1.1274e-07,
                2.9827e-08,
                5.2628e-07,
                1.8990e-07,
                7.0057e-07,
                1.4258e-07,
                5.8943e-08,
                1.6532e-06,
                2.3241e-07,
                6.9180e-08,
                5.2354e-07,
                1.6686e-08,
                1.1729e-07,
                1.5753e-06,
                2.1938e-07,
                1.2920e-08,
                3.1428e-06,
                4.8467e-08,
                2.7383e-06,
                1.6118e-06,
                1.3013e-07,
                1.5359e-07,
                2.9457e-07,
                2.3946e-07,
                2.6019e-08,
                7.0624e-08,
                4.4848e-07,
                8.9196e-07,
                6.3690e-09,
                4.9450e-08,
                1.0656e-08,
                1.3190e-07,
                8.2498e-08,
                4.3761e-08,
                4.4100e-08,
                1.3092e-07,
                1.6525e-08,
                9.9303e-08,
                1.0114e-07,
                3.1145e-07,
                6.4332e-08,
                4.1215e-07,
                9.0145e-08,
                7.1847e-07,
                8.4739e-07,
                5.4657e-07,
                2.6544e-08,
                1.3889e-07,
                2.3277e-07,
                1.1284e-07,
                6.7201e-08,
                2.4814e-07,
                6.1635e-09,
                3.3743e-07,
                4.9829e-07,
                4.1202e-08,
                1.9380e-07,
                1.2975e-07,
                1.3976e-06,
                2.3684e-07,
                1.8620e-06,
                3.7191e-07,
                3.4078e-06,
                6.8581e-07,
                4.4275e-06,
                1.0038e-06,
                2.5014e-06,
                3.9339e-07,
                2.6467e-06,
                3.5794e-07,
                6.6177e-07,
                2.2764e-07,
                1.3387e-05,
                4.8828e-05,
                7.7814e-07,
                4.0185e-06,
                4.1770e-06,
                1.0775e-06,
                1.0317e-05,
                1.9309e-04,
                1.9010e-07,
                3.6020e-06,
                1.8782e-05,
                1.2400e-06,
                2.3987e-07,
                1.2163e-07,
                1.6867e-07,
                3.0382e-07,
                5.4290e-06,
                1.2729e-07,
                1.2550e-07,
                8.8680e-06,
                8.6001e-08,
                8.9568e-08,
                1.1172e-06,
                2.9832e-06,
                8.7542e-08,
                2.4282e-07,
                5.8511e-07,
                6.1146e-05,
                5.2521e-06,
                6.3780e-08,
                1.7729e-08,
                1.2387e-05,
                2.4018e-06,
                1.9504e-07,
                9.9014e-07,
                7.2535e-06,
                6.7222e-06,
                3.7424e-07,
                1.7594e-06,
                2.5205e-07,
                2.9022e-08,
                2.7447e-09,
                2.8436e-08,
                4.0035e-09,
                1.3585e-05,
                3.6005e-07,
                6.5193e-06,
                4.1283e-05,
                2.2135e-06,
                3.3801e-07,
                3.6415e-06,
                1.3274e-06,
                7.0640e-07,
                2.4540e-06,
                4.8871e-08,
                2.5688e-07,
                7.3616e-08,
                2.2044e-07,
                3.4278e-09,
                4.2626e-08,
                8.9066e-08,
                1.8692e-07,
                4.4693e-07,
                1.1432e-05,
                5.4961e-06,
                5.4354e-08,
                1.2610e-07,
                8.9418e-06,
                1.2350e-07,
                9.4670e-07,
                3.2370e-07,
                9.3541e-08,
                1.5692e-07,
                8.4626e-08,
                2.6787e-08,
                5.4514e-06,
                1.5302e-06,
                8.1808e-08,
                7.7230e-08,
                2.1043e-05,
                1.3428e-05,
                4.0298e-06,
                1.2055e-06,
                5.1141e-07,
                5.1419e-05,
                6.3061e-05,
                5.5199e-08,
                1.4497e-06,
                7.5038e-05,
                1.2528e-06,
                1.0297e-07,
                5.6676e-05,
                4.9104e-05,
                4.7398e-04,
                2.5675e-03,
                3.8575e-04,
                6.5726e-06,
                3.3960e-04,
                2.9254e-03,
                7.4354e-05,
                2.0438e-04,
                3.5945e-07,
                2.4158e-03,
                9.9747e-06,
                2.4812e-06,
                4.4772e-05,
                1.9293e-05,
                1.4004e-04,
                1.0914e-04,
                3.0069e-04,
                1.4171e-05,
                1.6060e-05,
                4.1941e-05,
                7.6321e-06,
                7.2933e-06,
                4.9228e-05,
                1.2039e-06,
                1.6067e-04,
                1.7698e-04,
                3.3701e-06,
                2.4253e-06,
                8.1018e-07,
                9.6496e-06,
                4.6068e-06,
                5.3444e-07,
                6.4156e-06,
                1.6763e-04,
                4.7461e-05,
                2.5873e-05,
                1.7743e-06,
                7.0098e-04,
                3.3712e-05,
                3.5956e-04,
                7.6688e-06,
                7.4771e-06,
                8.8832e-06,
                2.1313e-05,
                9.9359e-05,
                1.2783e-05,
                1.1420e-02,
                9.5757e-05,
                3.3358e-06,
                8.1996e-08,
                1.4200e-03,
                5.6512e-04,
                3.5606e-05,
                7.2036e-05,
                4.2829e-06,
                4.4027e-06,
                2.3029e-06,
                3.6532e-04,
                4.2956e-06,
                6.3435e-05,
                1.5382e-04,
                6.8967e-04,
                6.2068e-07,
                7.8262e-05,
                1.6997e-05,
                8.9625e-03,
                3.2502e-06,
                5.3286e-07,
                2.3401e-04,
                4.0736e-03,
                1.9381e-05,
                5.4534e-08,
                1.1060e-05,
                9.4840e-06,
                4.0535e-03,
                5.4135e-04,
                3.6542e-05,
                3.2214e-05,
                2.0456e-03,
                1.4758e-04,
                1.0961e-03,
                2.0349e-04,
                1.8152e-05,
                2.3026e-06,
                3.9448e-05,
                1.0548e-04,
                7.2645e-05,
                4.1688e-06,
                2.2549e-03,
                7.5842e-04,
                8.9876e-08,
                2.1388e-05,
                7.6054e-07,
                1.6883e-06,
                1.2259e-03,
                4.0999e-03,
                1.0383e-05,
                2.1659e-06,
                4.8286e-07,
                2.7598e-05,
                8.7806e-06,
                5.7992e-06,
                7.6040e-07,
                9.7830e-06,
                9.4357e-05,
                3.7646e-05,
                2.1488e-04,
                5.4472e-01,
                2.5666e-05,
                4.5501e-05,
                4.3844e-06,
                1.3204e-05,
                2.0144e-05,
                1.7083e-06,
                1.2525e-02,
                3.1263e-06,
                6.4333e-03,
                3.9654e-06,
                6.7298e-06,
                1.2068e-04,
                7.2805e-05,
                9.3596e-07,
                1.8692e-02,
                1.6789e-05,
                2.9064e-05,
                5.5349e-06,
                3.2655e-06,
                2.0115e-05,
                4.2106e-05,
                1.4059e-06,
                8.3300e-08,
                6.5261e-06,
                9.3935e-06,
                4.7966e-02,
                3.7665e-05,
                3.6581e-04,
                3.9179e-05,
                2.8362e-03,
                1.0948e-04,
                1.6439e-04,
                3.1614e-06,
                6.1657e-07,
                2.1378e-04,
                8.1937e-05,
                4.2556e-04,
                9.9725e-06,
                3.0816e-05,
                9.7204e-08,
                4.6649e-06,
                3.9624e-07,
                1.3634e-04,
                2.0795e-04,
                7.8442e-05,
                1.8761e-06,
                1.2198e-03,
                5.7787e-05,
                3.0881e-05,
                9.5584e-07,
                6.3199e-04,
                1.0105e-05,
                1.0668e-04,
                2.3261e-08,
                8.8458e-04,
                3.2304e-06,
                1.8843e-06,
                1.9418e-07,
                2.1168e-03,
                5.6994e-06,
                3.2264e-04,
                2.4422e-06,
                5.4764e-05,
                3.9458e-06,
                2.5422e-06,
                3.2594e-03,
                1.4089e-06,
                2.7363e-07,
                1.6395e-05,
                6.6269e-06,
                4.6996e-05,
                2.8267e-04,
                2.1016e-04,
                4.5696e-06,
                1.5657e-04,
                3.8074e-05,
                2.3322e-03,
                5.1610e-04,
                3.2008e-07,
                4.5037e-05,
                3.0805e-06,
                3.8774e-04,
                9.2789e-04,
                1.1605e-06,
                3.7155e-03,
                2.0476e-04,
                9.9291e-06,
                1.1460e-04,
                4.3294e-05,
                1.8424e-04,
                2.4899e-08,
                3.9260e-06,
                4.1977e-05,
                5.9541e-06,
                2.7284e-05,
                3.9882e-05,
                5.0652e-08,
                3.6077e-05,
                8.9436e-04,
                1.9533e-06,
                1.5803e-04,
                1.6411e-04,
                6.2870e-05,
                4.6363e-07,
                9.4064e-06,
                8.4848e-06,
                1.8024e-06,
                1.3409e-05,
                2.1879e-06,
                1.2765e-05,
                2.9702e-04,
                4.4837e-06,
                1.9621e-05,
                3.4845e-04,
                1.4989e-02,
                1.7174e-03,
                1.4089e-05,
                1.0732e-02,
                1.1403e-05,
                1.3338e-06,
                7.1927e-06,
                1.9404e-04,
                2.4204e-05,
                1.5791e-02,
                1.1872e-04,
                9.3971e-06,
                1.0985e-04,
                1.6291e-06,
                2.3055e-06,
                5.9968e-07,
                2.1456e-05,
                4.5334e-06,
                2.0301e-06,
                1.2449e-04,
                1.8200e-07,
                1.6887e-05,
                1.7922e-05,
                2.6788e-03,
                1.0181e-06,
                3.9315e-06,
                4.3148e-07,
                1.0232e-05,
                4.7298e-05,
                1.2659e-03,
                3.2736e-07,
                2.4029e-04,
                8.4371e-04,
                1.5479e-06,
                2.0765e-07,
                1.7570e-04,
                2.9174e-05,
                2.8273e-04,
                4.7494e-04,
                6.9165e-05,
                1.9262e-05,
                3.4218e-06,
                1.0205e-06,
                1.7863e-04,
                7.8875e-07,
                9.6507e-06,
                3.7016e-05,
                3.9981e-05,
                1.3857e-04,
                7.5345e-03,
                5.5275e-04,
                5.9803e-06,
                7.2172e-06,
                1.5414e-06,
                4.0544e-06,
                4.0114e-06,
                1.8156e-05,
                1.1082e-04,
                1.2622e-05,
                1.2487e-05,
                3.8845e-06,
                2.9626e-04,
                4.8298e-06,
                1.9641e-04,
                1.7040e-08,
                3.5796e-05,
                3.6755e-06,
                1.4881e-04,
                1.5875e-03,
                3.8941e-03,
                1.3227e-03,
                9.3368e-03,
                3.3969e-07,
                1.9051e-03,
                8.8793e-06,
                1.6344e-06,
                2.1630e-04,
                8.9070e-07,
                1.8490e-05,
                1.8980e-04,
                3.0775e-04,
                2.0193e-05,
                1.4964e-04,
                1.0902e-06,
                4.6114e-04,
                7.0517e-04,
                1.4209e-05,
                7.3717e-06,
                3.7105e-06,
                1.0399e-05,
                7.0047e-07,
                3.2056e-06,
                4.4654e-04,
                8.8495e-04,
                2.1368e-05,
                4.2380e-04,
                2.6436e-06,
                5.2093e-05,
                2.2212e-06,
                1.2320e-04,
                2.0146e-06,
                1.7358e-03,
                2.6474e-03,
                6.7827e-05,
                9.6917e-07,
                8.5105e-06,
                3.6057e-06,
                7.0451e-07,
                2.2139e-03,
                2.0729e-04,
                4.4206e-07,
                4.0139e-04,
                1.2410e-03,
                3.3111e-06,
                1.2990e-06,
                1.8992e-03,
                6.8972e-05,
                3.7218e-05,
                3.4696e-04,
                4.9113e-04,
                9.4812e-06,
                2.1100e-06,
                1.7812e-05,
                1.6068e-05,
                1.1063e-04,
                1.0302e-05,
                3.4797e-04,
                4.2256e-05,
                1.7607e-04,
                3.4885e-04,
                9.8231e-05,
                1.8451e-05,
                6.1739e-05,
                6.9076e-04,
                7.3960e-06,
                4.4040e-05,
                4.8818e-05,
                1.9782e-05,
                1.3774e-05,
                1.2748e-05,
                7.7859e-07,
                2.0858e-06,
                1.0674e-03,
                1.0972e-06,
                2.1021e-02,
                5.5319e-05,
                2.5964e-05,
                9.3970e-05,
                3.7328e-06,
                1.6151e-05,
                4.9763e-07,
                1.1307e-04,
                1.4550e-04,
                6.8459e-05,
                1.0714e-04,
                3.6585e-04,
                2.1454e-03,
                9.9071e-05,
                3.6575e-05,
                1.5198e-03,
                4.3322e-06,
                1.3950e-06,
                3.3566e-05,
                5.6959e-05,
                2.8264e-07,
                2.6748e-04,
                2.1691e-03,
                6.2536e-05,
                7.4546e-07,
                1.8100e-06,
                2.8508e-03,
                7.1616e-06,
                2.0045e-05,
                3.6442e-04,
                3.6042e-06,
                2.6542e-05,
                2.1094e-04,
                8.7308e-05,
                2.3378e-04,
                2.5095e-06,
                2.7602e-06,
                1.5181e-05,
                7.9237e-04,
                2.6402e-05,
                2.5761e-07,
                1.1896e-05,
                2.2731e-05,
                2.0259e-03,
                8.2858e-05,
                1.7472e-03,
                1.0883e-07,
                2.0013e-07,
                1.5432e-04,
                2.9263e-05,
                7.7658e-05,
                1.3546e-03,
                2.0566e-03,
                2.1428e-05,
                3.5669e-05,
                2.1175e-07,
                3.7304e-07,
                3.0253e-05,
                2.4291e-06,
                2.8179e-06,
                3.6609e-04,
                8.1250e-04,
                2.3815e-06,
                1.3512e-04,
                5.9221e-03,
                7.9691e-07,
                3.2934e-05,
                6.5957e-06,
                1.9423e-06,
                2.9405e-05,
                7.0292e-05,
                1.4302e-04,
                1.1914e-06,
                2.6523e-06,
                2.6834e-06,
                3.6671e-04,
                1.2596e-03,
                3.8038e-07,
                3.6828e-04,
                7.7915e-04,
                1.4708e-07,
                7.2079e-06,
                1.0385e-04,
                2.7233e-06,
                4.9033e-05,
                6.0241e-06,
                1.5732e-04,
                2.0117e-04,
                5.1063e-07,
                2.8399e-04,
                7.9459e-06,
                1.3338e-03,
                7.8745e-06,
                2.5891e-05,
                3.2194e-04,
                1.9111e-03,
                1.7667e-04,
                1.4872e-04,
                2.9312e-03,
                7.2199e-06,
                9.1690e-07,
                3.5945e-06,
                2.7855e-04,
                1.7535e-05,
                1.3780e-05,
                2.4442e-05,
                1.1394e-05,
                2.5379e-05,
                2.2238e-06,
                2.0952e-05,
                2.0685e-04,
                9.1137e-06,
                7.8569e-06,
                5.3383e-05,
                2.8387e-07,
                5.4037e-05,
                2.8938e-07,
                1.3174e-04,
                3.7273e-06,
                2.2058e-04,
                5.8939e-05,
                2.6207e-07,
                2.7314e-07,
                9.6123e-06,
                2.9254e-04,
                5.7498e-07,
                5.9684e-04,
                1.1627e-06,
                4.5866e-06,
                1.5758e-04,
                6.5516e-06,
                3.1522e-04,
                7.6669e-07,
                6.6419e-05,
                1.8415e-07,
                1.0275e-06,
                1.2826e-06,
                3.6305e-07,
                3.4141e-04,
                2.9395e-03,
                2.3985e-05,
                6.7220e-06,
                4.9197e-06,
                8.0192e-06,
                1.1667e-01,
                5.6675e-06,
                1.2752e-04,
                3.6448e-05,
                8.6483e-04,
                1.4560e-05,
                3.3398e-04,
                3.4628e-04,
                1.0387e-04,
                4.5040e-06,
                8.4435e-07,
                3.5686e-07,
                1.1549e-07,
                2.3261e-07,
                6.2614e-08,
                2.1089e-07,
                4.7371e-05,
                3.1679e-06,
                7.9653e-07,
                4.8878e-07,
                2.5289e-08,
                1.1155e-06,
                1.1945e-07,
                2.2908e-07,
                2.9379e-08,
                2.0469e-06,
                2.4788e-07,
                1.5314e-07,
                7.1754e-08,
                4.1029e-07,
                1.9101e-07,
                1.8963e-07,
                4.7289e-08,
                3.7885e-07,
                1.1361e-07,
                6.6860e-07,
                3.7893e-07,
                1.2665e-07,
                7.5658e-08,
                1.6936e-07,
                7.1698e-08,
                3.6984e-07,
                3.6376e-08,
                3.0783e-08,
                2.1762e-07,
                3.1531e-05,
                4.6537e-07,
                2.7843e-07,
                6.7744e-06,
                1.8720e-06,
                2.9693e-07,
                4.0405e-07,
                3.9948e-06,
                1.6449e-05,
                4.5527e-06,
                8.6000e-06,
                1.9351e-06,
                2.4189e-04,
                1.2237e-05,
                4.3519e-04,
                9.8503e-06,
                2.8016e-06,
                4.1595e-03,
                8.9333e-05,
                8.8940e-05,
                4.3075e-04,
                3.0794e-05,
                1.7490e-05,
                5.5095e-05,
                4.7048e-06,
                2.5128e-04,
                4.3988e-06,
                2.6698e-08,
                2.4547e-09,
                1.1608e-05,
                2.3761e-07,
                4.3923e-08,
                8.4034e-08,
                4.3723e-08,
                7.5340e-08,
                7.0168e-09,
                2.3958e-07,
                1.0182e-07,
                1.5610e-07,
                4.7116e-08,
                2.3649e-06,
                3.7093e-06,
            ]
        ),
    )

    model = YoloCls.from_yolo_results([result])

    model_dict = model.model_dump()
    assert set(model_dict.keys()) == {"cls", "name", "confidence"}
    assert model_dict["cls"] == [510, 913, 536, 769, 525]
    assert model_dict["name"] == ["container_ship", "wreck", "dock", "rule", "dam"]
    assert_array_almost_equal(
        model_dict["confidence"],
        [0.5447, 0.1167, 0.048, 0.021, 0.0187],
        decimal=3,
    )
